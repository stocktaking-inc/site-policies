name: Notify Monorepo
  on:
    push:
      branches: ['main']
  jobs:
    notify:
      runs-on: ubuntu-latest
      steps:
        - name: Debug variables
          run: |
            echo "APP_ID: ${{ vars.APP_ID }}"
            echo "APP_PRIVATE_KEY: ${{ secrets.APP_PRIVATE_KEY != '' && 'set' || 'not set' }}"
        - name: Generate GitHub App token
          id: app-token
          uses: actions/create-github-app-token@v1
          with:
            app-id: ${{ vars.APP_ID }}
            private-key: ${{ secrets.APP_PRIVATE_KEY }}
        - name: Trigger monorepo workflow
          run: |
            curl -X POST \
              -H "Accept: application/vnd.github.v3+json" \
              -H "Authorization: Bearer ${{ steps.app-token.outputs.token }}" \
              https://api.github.com/repos/stocktaking-inc/inventory-monorepo/dispatches \
              -d '{"event_type": "submodule_updated", "client_payload": {"submodule": "site-policies"}}'
